!function(){function a(a,b){"use strict";var c={};c.version="1.1.0-dev",c.constants={DEFAULT_MOVING_AVERAGE_NODES:2};var c=c||{};c.accumulateGroupForNDayMovingAverage=function(a,d){if(!a||!a.all||"function"!=typeof a.all)throw new Error("You must pass in a crossfilter group!");d="undefined"!=typeof d?d:c.constants.DEFAULT_MOVING_AVERAGE_NODES;var e=function(a){return a.key},f=function(a){return a.value};return{ndays:function(a){return"undefined"==typeof a?d:void(d=a)},all:function(){var b=0,c=a.all(),e=c.map(function(a,c,e){for(var f=d,g=0,h=0,i=0,j=[];--f>0;){var k=e[c-f];k&&(g++,h+=k.value,j.push({key:k.key,value:k.value}))}return g++,h+=a.value,b+=a.value,j.push({key:a.key,value:a.value}),i=h/g,{key:a.key,value:a.value,rollingAverage:i,_debug:{cumulate:b,thisResult:j}}});return e},top:function(){var c=0,g=a.top.apply(a,arguments),h={},i=b(g),j=i.dimension(function(a){return a.key}),k=j.group(),l=k.reduce(function(a,b){var c=e(b),d=f(b);return h[c]?h[c].myValue+=d:h[c]={myValue:d},a},function(a,b){var c=e(b),d=f(b);return h[c]?h[c].quantity-=d:delete h[c],a},function(){h={}});l.all();var m=g.map(function(a){for(var b=Object.keys(h).sort(),f=b.indexOf(e(a)),g=d,i=0,j=0,k=0,l=[];--g>0;){var m=b[f-g];if(m){var n=h[m],o=n.myValue;i++,j+=o,l.push({key:m,value:o})}}return i++,j+=a.value,c+=a.value,l.push({key:a.key,value:a.value}),k=j/i,{key:a.key,value:a.value,rollingAverage:k,_debug:{cumulate:c,thisResult:l}}});return m}}};var c=c||{};return c.accumulateGroupForPercentageChange=function(a){if(!a||!a.all||"function"!=typeof a.all)throw new Error("You must pass in a crossfilter group!");var c=function(a){return a.key},d=function(a){return a.value};return{all:function(){var e=a.all(),f={},g=b(e),h=g.dimension(function(a){return a.key}),i=h.group(),j=i.reduce(function(a,b){var e=c(b),g=d(b);return f[e]?f[e].myValue+=g:f[e]={myValue:g},a},function(a,b){var e=c(b),g=d(b);return f[e]?f[e].quantity-=g:delete f[e],a},function(){f={}});j.all();var k=e.map(function(a,b,c){var e=a,f=c[b-1],g=0;if(f){var h=d(e)-d(f);if(0!==h){var i=h/d(f);g=100*i}else g=0}return{key:a.key,value:a.value,percentageChange:g,_debug:{thisDayKey:e.key,thisDayValue:e.value,prevDayKey:f?f.key:"None",prevDayValue:f?f.value:"None"}}});return k},top:function(){var e=a.top.apply(a,arguments),f={},g=b(e),h=g.dimension(function(a){return a.key}),i=h.group(),j=i.reduce(function(a,b){var e=c(b),g=d(b);return f[e]?f[e].myValue+=g:f[e]={myValue:g},a},function(a,b){var e=c(b),g=d(b);return f[e]?f[e].quantity-=g:delete f[e],a},function(){f={}});j.all();var k=e.map(function(a){var b,e=a,g=0,h=Object.keys(f).sort(),i=h.indexOf(c(a)),j=h[i-1];if(j){var k=f[j];b=k.myValue;var l=d(e)-b;if(0!==l){var m=l/b;g=100*m}else g=0}return{key:a.key,value:a.value,percentageChange:g,_debug:{thisDayKey:e.key,thisDayValue:e.value,prevDayKey:j?j:"None",prevDayValue:j?b:"None"}}});return k}}},c.d3=a,c.crossfilter=b,c}if("function"==typeof define&&define.amd)define(["d3","crossfilter"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter),module.exports=a(b,c)}else this["crossfilter-ma"]=a(d3,crossfilter)}();
//# sourceMappingURL=crossfilter-ma.min.js.map