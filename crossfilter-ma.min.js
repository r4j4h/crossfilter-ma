!function(){function a(a){"use strict";function b(a,b){1===a?b.sort(function(a,b){return a.rollingAverage>b.rollingAverage?1:a.rollingAverage<b.rollingAverage?-1:0}):-1===a&&b.sort(function(a,b){return a.rollingAverage>b.rollingAverage?-1:a.rollingAverage<b.rollingAverage?1:0})}function c(a,b,c){var d={};a.forEach(function(a){d[b(a)]=c(a)});var e=Object.keys(d).sort();return{datesHash:d,orderedDates:e}}function d(a,b){var c,d;if("undefined"==typeof a||"undefined"==typeof b||0===a)return 0/0;if(c=0,d=b-a,0!==d){var e=d/a;c=100*e}else c=0;return c}function e(a,b){return 1===a?b.sort(function(a,b){return isNaN(a.percentageChange)?-1:isNaN(b.percentageChange)?1:a.percentageChange>b.percentageChange?1:a.percentageChange<b.percentageChange?-1:0}):-1===a&&b.sort(function(a,b){return isNaN(a.percentageChange)?1:isNaN(b.percentageChange)?-1:a.percentageChange>b.percentageChange?-1:a.percentageChange<b.percentageChange?1:0}),b}function f(a){return Object.keys(a).map(function(b){return a[b]})}function g(a,b){return 1===a?(b=f(b),e(a,b)):-1===a?(b=f(b),e(a,b)):!1}var h={};h.version="1.2.2",h.constants={DEFAULT_MOVING_AVERAGE_NODES:2};var h=h||{};h.accumulateGroupForNDayMovingAverage=function(a,c,d,e){if(!a||!a.all||"function"!=typeof a.all)throw new Error("You must pass in a crossfilter group!");c="undefined"!=typeof c?c:h.constants.DEFAULT_MOVING_AVERAGE_NODES,e="undefined"!=typeof e?!!e:!1,d="undefined"!=typeof d?!!d:!1;var f,g,i=!1;return{ndays:function(a){return"undefined"==typeof a?c:void(c=a)},rolldown:function(a){return"undefined"==typeof a?d:void(d=!!a)},_debug:function(a){return"undefined"==typeof a?e:void(e=!!a)},_defaultKeyAccessor:function(){return function(a){return a.key}},_defaultValueAccessor:function(){return function(a){return a.value}},keyAccessor:function(a){return"undefined"==typeof a?("undefined"==typeof f&&(f=this._defaultKeyAccessor()),f):void(f=a)},valueAccessor:function(a){return"undefined"==typeof a?("undefined"==typeof g&&(g=this._defaultValueAccessor()),g):void(g=a)},orderByMovingAverage:function(a){if("undefined"==typeof a)return i;switch(a){case 1:i=1;break;case-1:i=-1;break;default:case 0:i=!1}},all:function(){var f=this,g=0,h=a.all(),j={};h.forEach(function(a){j[f.keyAccessor()(a)]=f.valueAccessor()(a)});var k=Object.keys(j).sort(),l=h.map(function(a){for(var b=f.keyAccessor()(a),h=f.valueAccessor()(a),i=k.indexOf(b),l=c,m=0,n=0,o=0,p=[];--l>0;){var q=k[i-l];if(!q&&!d)break;if(q){var r=j[q],s=r;m++,n+=s,e&&p.push({key:q,value:s})}}m++,n+=h,e&&(g+=h,p.push({key:b,value:h})),o=n/m,c>m&&!d&&(o=0);var t={key:b,value:h,rollingAverage:o};return e&&(t._debug={cumulate:g,datumsUsed:p}),t});return b(i,l),l},top:function(){var f=this,g=0,h=a.top.apply(a,arguments),j={};h.forEach(function(a){j[f.keyAccessor()(a)]=f.valueAccessor()(a)});var k=Object.keys(j).sort(),l=h.map(function(a){for(var b=f.keyAccessor()(a),h=f.valueAccessor()(a),i=k.indexOf(b),l=c,m=0,n=0,o=0,p=[];--l>0;){var q=k[i-l];if(!q&&!d)break;if(q){var r=j[q],s=r;m++,n+=s,e&&p.push({key:q,value:s})}}m++,n+=h,e&&(g+=h,p.push({key:b,value:h})),o=n/m,c>m&&!d&&(o=0);var t={key:b,value:h,rollingAverage:o};return e&&(t._debug={cumulate:g,datumsUsed:p}),t});return b(i,l),l}}};var h=h||{};return h.accumulateGroupForPercentageChange=function(a,b){if(!a||!a.all||"function"!=typeof a.all)throw new Error("You must pass in a crossfilter group!");b="undefined"!=typeof b?!!b:!1;var f,h,i,j,k=!1,l=!1;return{_debug:function(a){return"undefined"==typeof a?b:void(b=!!a)},_defaultKeyAccessor:function(){return function(a){return a.key}},_defaultValueAccessor:function(){return function(a){return a.value}},_defaultCalculationAccessor:function(){return function(a){return a}},_defaultIterationAccessor:function(){return""},keyAccessor:function(a){return"undefined"==typeof a?("undefined"==typeof f&&(f=this._defaultKeyAccessor()),f):void(f=a)},valueAccessor:function(a){return"undefined"==typeof a?("undefined"==typeof h&&(h=this._defaultValueAccessor()),h):void(h=a)},calculationAccessor:function(a){return"undefined"==typeof a?("undefined"==typeof i&&(i=this._defaultCalculationAccessor()),i):void(i=a)},iterationAccessor:function(a){return"undefined"==typeof a?("undefined"==typeof j&&(j=this._defaultIterationAccessor()),j):void(j=a)},orderByPercentageChange:function(a){if("undefined"==typeof a)return k;switch(a){case 1:k=1;break;case-1:k=-1;break;default:case 0:k=!1}},orderOnlyNestedValuesByPercentageChange:function(a){if("undefined"==typeof a)return l;switch(a){case!0:case!1:l=a;break;default:case 0:}},all:function(){var f=this,h=a.all(),i=c(h,f.keyAccessor(),f.valueAccessor()),j=i.datesHash,m=i.orderedDates,n=h.map(function(a){var c={},e=0,h=f.iterationAccessor(),i=m.indexOf(f.keyAccessor()(a)),l=m[i],n=j[l],o=f.calculationAccessor()(n),p=n?n[h]:void 0,q=i-1,r=m[q],s="undefined"!=typeof r?j[r]:void 0,t="undefined"!=typeof s?f.calculationAccessor()(s):void 0,u=s?s[h]:void 0;if(p||u){Object.keys(p||u).forEach(function(a){var g=p&&p[a]?f.calculationAccessor()(p[a]):void 0,i=u&&u[a]?f.calculationAccessor()(u[a]):void 0;e=d(i,g),c[h]=c[h]||{},c[h][a]=c[h][a]||{},b&&(c[h][a]._debug={key:a,value:g,prevKey:i?a:"None",prevValue:i?i:"None"},c._debug=c._debug||{},c._debug[h]=c._debug[h]||{},c._debug[h][a]={key:a,value:g,prevKey:i?a:"None",prevValue:i?i:"None"}),c[h][a].key=a,c[h][a].value=g,c[h][a].percentageChange=e});var v=g(k,c[h]);v&&(c[h]=v)}return e=d(t,o),c.key=l,c.value=o,c.percentageChange=e,b&&(c._debug={thisDayKey:l,thisDayValue:n,thisDayCalculatedValue:o,prevDayKey:r?r:"None",prevDayValue:s?s:"None",prevDayCalculatedValue:t}),c});return l||e(k,n),n},top:function(){var f=this,h=a.top.apply(a,arguments),i=c(h,f.keyAccessor(),f.valueAccessor()),j=i.datesHash,m=i.orderedDates,n=h.map(function(a){var c={},e=0,h=f.iterationAccessor(),i=m.indexOf(f.keyAccessor()(a)),l=m[i],n=j[l],o=f.calculationAccessor()(n),p=n?n[h]:void 0,q=i-1,r=m[q],s="undefined"!=typeof r?j[r]:void 0,t="undefined"!=typeof s?f.calculationAccessor()(s):void 0,u=s?s[h]:void 0;if(p||u){Object.keys(p||u).forEach(function(a){var g=p&&p[a]?f.calculationAccessor()(p[a]):void 0,i=u&&u[a]?f.calculationAccessor()(u[a]):void 0;e=d(i,g),c[h]=c[h]||{},c[h][a]=c[h][a]||{},b&&(c[h][a]._debug={key:a,value:g,prevKey:i?a:"None",prevValue:i?i:"None"},c._debug=c._debug||{},c._debug[h]=c._debug[h]||{},c._debug[h][a]={key:a,value:g,prevKey:i?a:"None",prevValue:i?i:"None"}),c[h][a].key=a,c[h][a].value=g,c[h][a].percentageChange=e});var v=g(k,c[h]);v&&(c[h]=v)}return e=d(t,o),c.key=l,c.value=o,c.percentageChange=e,b&&(c._debug=c._debug||{},c._debug.thisDayKey=l,c._debug.thisDayValue=o,c._debug.prevDayKey=r?r:"None",c._debug.prevDayValue=r?t:"None"),c});return l||e(k,n),n}}},h.crossfilter=a,h}if("function"==typeof define&&define.amd)define(["crossfilter"],a);else if("object"==typeof module&&module.exports){var b=require("crossfilter");"function"!=typeof b&&(b=b.crossfilter),module.exports=a(b)}else this["crossfilter-ma"]=a(crossfilter),this.crossfilter$ma=this["crossfilter-ma"]}();
//# sourceMappingURL=crossfilter-ma.min.js.map