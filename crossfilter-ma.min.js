!function(){function a(a,b){"use strict";var c={};c.version="1.2.0",c.constants={DEFAULT_MOVING_AVERAGE_NODES:2};var c=c||{};c.accumulateGroupForNDayMovingAverage=function(a,d,e,f){if(!a||!a.all||"function"!=typeof a.all)throw new Error("You must pass in a crossfilter group!");d="undefined"!=typeof d?d:c.constants.DEFAULT_MOVING_AVERAGE_NODES,f="undefined"!=typeof f?!!f:!1,e="undefined"!=typeof e?!!e:!1;var g=function(a){return a.key},h=function(a){return a.value};return{ndays:function(a){return"undefined"==typeof a?d:void(d=a)},rolldown:function(a){return"undefined"==typeof a?e:void(e=!!a)},_debug:function(a){return"undefined"==typeof a?f:void(f=!!a)},all:function(){var b=0,c=a.all(),g=c.map(function(a,c,g){for(var h=d,i=0,j=0,k=0,l=[];--h>0;){var m=g[c-h];if(!m&&!e)break;m&&(i++,j+=m.value,f&&l.push({key:m.key,value:m.value}))}i++,j+=a.value,f&&(b+=a.value,l.push({key:a.key,value:a.value})),k=j/i,d>i&&!e&&(k=0);var n={key:a.key,value:a.value,rollingAverage:k};return f&&(n._debug={cumulate:b,datumsUsed:l}),n});return g},top:function(){var c=0,i=a.top.apply(a,arguments),j={},k=b(i),l=k.dimension(function(a){return a.key}),m=l.group(),n=m.reduce(function(a,b){var c=g(b),d=h(b);return j[c]?j[c].myValue+=d:j[c]={myValue:d},a},function(a,b){var c=g(b),d=h(b);return j[c]?j[c].quantity-=d:delete j[c],a},function(){j={}});n.all();var o=i.map(function(a){for(var b=Object.keys(j).sort(),h=b.indexOf(g(a)),i=d,k=0,l=0,m=0,n=[];--i>0;){var o=b[h-i];if(!o&&!e)break;if(o){var p=j[o],q=p.myValue;k++,l+=q,f&&n.push({key:o,value:q})}}k++,l+=a.value,f&&(c+=a.value,n.push({key:a.key,value:a.value})),m=l/k,d>k&&!e&&(m=0);var r={key:a.key,value:a.value,rollingAverage:m};return f&&(r._debug={cumulate:c,datumsUsed:n}),r});return o}}};var c=c||{};return c.accumulateGroupForPercentageChange=function(a,c){if(!a||!a.all||"function"!=typeof a.all)throw new Error("You must pass in a crossfilter group!");c="undefined"!=typeof c?!!c:!1;var d=function(a){return a.key},e=function(a){return a.value};return{_debug:function(a){return"undefined"==typeof a?c:void(c=!!a)},all:function(){var f=a.all(),g={},h=b(f),i=h.dimension(function(a){return a.key}),j=i.group(),k=j.reduce(function(a,b){var c=d(b),f=e(b);return g[c]?g[c].myValue+=f:g[c]={myValue:f},a},function(a,b){var c=d(b),f=e(b);return g[c]?g[c].quantity-=f:delete g[c],a},function(){g={}});k.all();var l=f.map(function(a,b,d){var f=a,g=d[b-1],h=0;if(g){var i=e(f)-e(g);if(0!==i){var j=i/e(g);h=100*j}else h=0}var k={key:a.key,value:a.value,percentageChange:h};return c&&(k._debug={thisDayKey:f.key,thisDayValue:f.value,prevDayKey:g?g.key:"None",prevDayValue:g?g.value:"None"}),k});return l},top:function(){var f=a.top.apply(a,arguments),g={},h=b(f),i=h.dimension(function(a){return a.key}),j=i.group(),k=j.reduce(function(a,b){var c=d(b),f=e(b);return g[c]?g[c].myValue+=f:g[c]={myValue:f},a},function(a,b){var c=d(b),f=e(b);return g[c]?g[c].quantity-=f:delete g[c],a},function(){g={}});k.all();var l=f.map(function(a){var b,f=a,h=0,i=Object.keys(g).sort(),j=i.indexOf(d(a)),k=i[j-1];if(k){var l=g[k];b=l.myValue;var m=e(f)-b;if(0!==m){var n=m/b;h=100*n}else h=0}var o={key:a.key,value:a.value,percentageChange:h};return c&&(o._debug={thisDayKey:f.key,thisDayValue:f.value,prevDayKey:k?k:"None",prevDayValue:k?b:"None"}),o});return l}}},c.d3=a,c.crossfilter=b,c}if("function"==typeof define&&define.amd)define(["d3","crossfilter"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter),module.exports=a(b,c)}else this["crossfilter-ma"]=a(d3,crossfilter)}();
//# sourceMappingURL=crossfilter-ma.min.js.map